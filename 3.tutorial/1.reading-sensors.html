<!DOCTYPE html> <html lang="en" dir="auto"> <head><meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=no"> <meta name="description" content="Reading sensors Constructor The constructor registers a free peripheral slot to store its arguments. The constructors uses setter methods to set th..."> <meta name="revised" content="915f8f35814363076ca83950ca026e860c5ef2da"> <meta name="author" content="iothingy"> <meta name="generator" content="rundocs/jekyll-rtd-theme v2.0.10"><meta name="theme-color" content="#2980b9"> <title>Reading sensors 路 IoThingy</title> <meta name="twitter:title" content="Reading sensors 路 IoThingy"> <meta name="twitter:description" content="Reading sensors Constructor The constructor registers a free peripheral slot to store its arguments. The constructors uses setter methods to set th..."> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@iothingy"> <meta name="twitter:url" content="https://iothingy.io//pages/iothingy/website/3.tutorial/1.reading-sensors.html"> <meta name="twitter:creator" content="@rundocs/jekyll-rtd-theme v2.0.10"> <meta property="og:title" content="Reading sensors 路 IoThingy"> <meta property="og:description" content="Reading sensors Constructor The constructor registers a free peripheral slot to store its arguments. The constructors uses setter methods to set th..."> <meta property="og:locale" content="en"> <meta property="og:url" content="https://iothingy.io//pages/iothingy/website/3.tutorial/1.reading-sensors.html"> <meta property="og:type" content="article"> <meta property="article:author" content="iothingy"> <meta property="article:published_time" content="2021-02-25T02:48:04+00:00"> <meta property="article:modified_time" content="2021-02-25T02:48:04+00:00"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Article", "mainEntityOfPage": { "@type": "WebPage", "@id": "https://iothingy.io//pages/iothingy/website/3.tutorial/1.reading-sensors.html" }, "headline": "Reading sensors 路 IoThingy", "image": [], "author": { "@type": "Person", "name": "iothingy" }, "datePublished": "2021-02-25T02:48:04+00:00", "dateModified": "2021-02-25T02:48:04+00:00", "publisher": { "@type": "Organization", "name": "iothingy", "logo": { "@type": "ImageObject", "url": "https://avatars.githubusercontent.com/u/78229720?v=4" } }, "description": "Reading sensors Constructor The constructor registers a free peripheral slot to store its arguments. The constructors uses setter methods to set th..." } </script> <link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="prev" href="https://iothingy.io//pages/iothingy/website/3.tutorial/3.using-timers.html"><link rel="canonical" href="https://iothingy.io//pages/iothingy/website/3.tutorial/1.reading-sensors.html"><link rel="icon" type="image/svg+xml" href="/pages/iothingy/website/assets/images/favicon.svg"><link rel="icon" type="image/png" href="/pages/iothingy/website/assets/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/pages/iothingy/website/assets/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/pages/iothingy/website/assets/images/favicon-96x96.png" sizes="96x96"><link rel="mask-icon" href="/pages/iothingy/website/assets/images/favicon.svg" color="#2980b9"><link rel="apple-touch-icon" href="/pages/iothingy/website/assets/images/apple-touch-icon-300x300.jpg"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/css/theme.min.css"><script> window.ui = { title: "IoThingy", baseurl: "/pages/iothingy/website", i18n: { search_results: "Search Results", search_results_found: "Search finished, found # page(s) matching the search query.", search_results_not_found: "Your search did not match any documents, please make sure that all characters are spelled correctly!" } }; </script> </head> <body class="container"><div class="sidebar-wrap overflow-hidden"> <div class="sidebar height-full overflow-y-scroll overflow-x-hidden"> <div class="header d-flex flex-column p-3 text-center"> <div class="title pb-1"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/pages/iothingy/website/" title="Core library for writing your own IoThingies by implementing your custom peripherals and/or using existing ones from other projects. It uses MQTT to send metrics of each peripheral and/or receive commands to change state."> <i class="fa fa-home"></i> IoThingy </a> </div> <span class="version"></span> <form class="search pt-2" action="/pages/iothingy/website/search.html" method="get" autocomplete="off"> <input class="form-control input-block input-sm" type="text" name="q" placeholder="Search docs..."> </form> </div> <div class="toctree py-2" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> </ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/pages/iothingy/website/1.getting-started/"> Getting started </a><ul> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/1.getting-started/1.install.html">Installation</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/1.getting-started/2-code.html">Code</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/1.getting-started/3-settings.html">Settings</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/1.getting-started/4.upload.html">Upload</a> </li></ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/pages/iothingy/website/2.documentation/"> Documentation </a><ul> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/2.documentation/1.process-flow.html">Process flow</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/2.documentation/2.platforms.html">Platforms</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/2.documentation/3.memory-usage.html">Memory usage</a> </li></ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/pages/iothingy/website/4.resources/"> Resources </a><ul> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/4.resources/peripherals.html">Peripherals</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/4.resources/projects.html">Projects</a> </li></ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/pages/iothingy/website/3.tutorial/"> Tutorial </a><ul> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/3.tutorial/2.controlling-actuators.html">Controlling actuators</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/pages/iothingy/website/3.tutorial/3.using-timers.html">Using timers</a> </li> <li class="toc level-1 current" data-sort="" data-level="1"> <a class="d-flex flex-items-baseline current" href="/pages/iothingy/website/3.tutorial/1.reading-sensors.html">Reading sensors</a> </li></ul> </div> </div> </div> <div class="content-wrap"> <div class="header d-flex flex-justify-between p-2 hide-lg hide-xl" aria-label="top navigation"> <button id="toggle" aria-label="Toggle menu" class="btn-octicon p-2 m-0 text-white" type="button"> <i class="fa fa-bars"></i> </button> <div class="title flex-1 d-flex flex-justify-center"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/pages/iothingy/website/">IoThingy</a> </div> </div> <div class="content p-3 p-sm-5"> <div class="navigation-top d-flex flex-justify-between"> <ul class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation"> <li class="breadcrumb-item"> <a class="no-underline" href="/pages/iothingy/website/" title="/"> <i class="fa fa-home"></i> </a> </li><li class="breadcrumb-item" ><a href="/pages/iothingy/website/3.tutorial/">3.tutorial</a></li><li class="breadcrumb-item" aria-current="page">1.reading-sensors.md</li></ul> <a class="edit" href="https://github.com/iothingy/website/edit/gh-pages/3.tutorial/1.reading-sensors.md" title="Edit on GitHub" rel="noreferrer" target="_blank"> <i class="fa fa-edit"></i> </a> </div> <hr> <div role="main" itemscope="itemscope" itemtype="https://schema.org/Article"> <div class="markdown-body" itemprop="articleBody"> <h1 id="reading-sensors">Reading sensors</h1> <h2 id="constructor">Constructor</h2> <p>The constructor registers a free peripheral slot to store its arguments. The constructors uses setter methods to set the invidual variables and defaults. This is better than method chaining as it uses less memory of the stack (memory is often scarce).</p> <div class="language-c highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Instantiate a plant peripheral with only an analog input pin to measure the
 * moisture level.
 */</span>
<span class="kt">int8_t</span> <span class="nf">plant</span><span class="p">(</span> <span class="kt">char</span> <span class="n">name</span><span class="p">[],</span> <span class="kt">uint8_t</span> <span class="n">moisture_pin</span> <span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Get free peripheral slot</span>
  <span class="kt">int8_t</span> <span class="n">slot</span> <span class="o">=</span> <span class="n">peripheral_register</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">TYPE_PLANT</span> <span class="p">);</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">slot</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">plant_set_moisture_pin</span><span class="p">(</span> <span class="n">slot</span><span class="p">,</span> <span class="n">moisture_pin</span> <span class="p">);</span>
  <span class="k">return</span> <span class="n">slot</span><span class="p">;</span>
<span class="p">}</span> 


<span class="kt">void</span> <span class="nf">plant_set_moisture_pin</span><span class="p">(</span> <span class="kt">uint8_t</span> <span class="n">slot</span><span class="p">,</span><span class="kt">uint8_t</span> <span class="n">moisture_pin</span> <span class="p">)</span> <span class="p">{</span>
  <span class="n">SERIAL_DEBUG_S</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">"- misture pin: "</span><span class="p">));</span>
  <span class="n">SERIAL_DEBUG_I</span><span class="p">(</span><span class="n">moisture_pin</span><span class="p">);</span>
  <span class="n">SERIAL_DEBUG_S</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">));</span>  

  <span class="n">peripherals</span><span class="p">[</span> <span class="n">slot</span> <span class="p">].</span><span class="n">pin01</span> <span class="o">=</span> <span class="n">moisture_pin</span><span class="p">;</span>
  <span class="n">peripheral_set_pin_mode</span><span class="p">(</span> <span class="n">peripherals</span><span class="p">[</span><span class="n">slot</span><span class="p">].</span><span class="n">pin01</span><span class="p">,</span> <span class="n">INPUT</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre>  </div></div> <h2 id="reading-input-pins">Reading input pins</h2> <p>Every iteration we want to ready the moisture level sensor and store its value. Implement a method with the name <em>&lt;name&gt;_read_input_pins</em>. This method should only read and store values, but not update any output pins as that will be done by another method.</p> <div class="language-c highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Read the pin value(s) for an analog peripheral and store it in its value.
 */</span>
<span class="kt">void</span> <span class="nf">plant_read_input_pins</span><span class="p">(</span> <span class="kt">uint8_t</span> <span class="n">slot</span> <span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Read analog input sensor.</span>
  <span class="k">if</span><span class="p">(</span> <span class="n">peripherals</span><span class="p">[</span><span class="n">slot</span><span class="p">].</span><span class="n">pin01</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">peripherals</span><span class="p">[</span> <span class="n">slot</span> <span class="p">].</span><span class="n">val03</span><span class="p">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">analogRead</span><span class="p">(</span> <span class="n">peripherals</span><span class="p">[</span><span class="n">slot</span><span class="p">].</span><span class="n">pin01</span> <span class="p">);</span>

    <span class="n">SERIAL_DEBUG_S</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">"- read moisture: "</span><span class="p">));</span>
    <span class="n">SERIAL_DEBUG_I</span><span class="p">(</span> <span class="n">peripherals</span><span class="p">[</span> <span class="n">slot</span> <span class="p">].</span><span class="n">val03</span><span class="p">.</span><span class="n">i</span> <span class="p">);</span>
    <span class="n">SERIAL_DEBUG_S</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>  </div></div> <h2 id="publishing-metrics">Publishing metrics</h2> <p>Reading the value from a sensor is useless unless you do something with it. In most cases you want to publish the value of this sensor to a MQTT topic. Implement a method with the name <em>&lt;name&gt;_publish_metrics</em>. This method should call the method <em>peripheral_publish_metric_int</em> or <em>peripheral_publish_metric_float</em> to send a value to MQTT/Serial. The metric name (3rd parameter) is used for the topic name: *&lt;device&gt;/&lt;peripheral&gt;/&lt;metric&gt;</p> <div class="language-c highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Publish metrics to MQTT/Serial.
 */</span>
<span class="kt">void</span> <span class="nf">plant_publish_metrics</span><span class="p">(</span> <span class="kt">uint8_t</span> <span class="n">slot</span> <span class="p">)</span> <span class="p">{</span>
  <span class="n">peripheral_publish_metric_int</span><span class="p">(</span> <span class="n">slot</span><span class="p">,</span> <span class="n">peripherals</span><span class="p">[</span><span class="n">slot</span><span class="p">].</span><span class="n">val03</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="s">"moisture"</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre>  </div></div> </div> </div> <div class="navigation-bottom d-flex flex-justify-between py-3" role="navigation" aria-label="footer navigation"> <div class="prev"><a href="/pages/iothingy/website/3.tutorial/3.using-timers.html" class="btn" title="Using timers" accesskey="p" rel="prev"> <i class="fa fa-arrow-circle-left"></i> Previous </a></div> <div class="next"></div> </div><hr> <div class="copyright text-center text-gray" role="contentinfo"> <i class="fa fa-copyright"></i> <span class="time">2021,</span> <a class="text-gray" href="https://github.com/iothingy" rel="noreferrer" target="_blank">iothingy</a> Revision <a class="text-gray" href="https://github.com/iothingy/website/commit/915f8f35814363076ca83950ca026e860c5ef2da" title="915f8f35814363076ca83950ca026e860c5ef2da" rel="noreferrer" target="_blank">915f8f3</a> <br> <div class="generator"> Built with <a href="https://pages.github.com" rel="noreferrer" target="_blank" title="github-pages v209">GitHub Pages</a> using a <a href="https://github.com/rundocs/jekyll-rtd-theme" rel="noreferrer" target="_blank" title="rundocs/jekyll-rtd-theme v2.0.10">theme</a> provided by <a href="https://rundocs.io" rel="noreferrer" target="_blank">RunDocs</a>. </div> </div> </div> </div> <div class="addons-wrap d-flex flex-column overflow-y-auto"> <div class="status d-flex flex-justify-between p-2"> <div class="title p-1"> <i class="fa fa-book"></i> IoThingy </div> <div class="branch p-1"> <span class="name"> gh-pages </span> <i class="fa fa-caret-down"></i> </div> </div> <div class="addons d-flex flex-column height-full p-2 d-none"> <dl> <dt>GitHub</dt> <dd> <a href="https://github.com/iothingy/website" title="Stars: "> <i class="fa fa-github"></i> Homepage </a> </dd> <dd> <a href="https://github.com/iothingy/website/issues" title="Open issues: "> <i class="fa fa-question-circle-o"></i> Issues </a> </dd> <dd> <a href="https://github.com/iothingy/website/zipball/gh-pages" title="Size: Kb"> <i class="fa fa-download"></i> Download </a> </dd> </dl> <hr> <div class="license f6 pb-2"> This <a href="/pages/iothingy/website/" title="IoThingy">Software</a> is under the terms of <a href="https://github.com/iothingy/website">The Unlicense</a>. </div> </div> </div> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/theme.min.js"></script> </body> </html>